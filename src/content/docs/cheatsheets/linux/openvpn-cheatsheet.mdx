---
title: "OpenVPN Cheatsheet"
description: "Quick reference for OpenVPN server and client setup, certificates, and gateway configuration."
sidebar:
  label: "OpenVPN Cheatsheet"
  order: 8
  badge:
    text: "Mid"
    variant: "caution"
tableOfContents: true
---

import { Badge } from "@astrojs/starlight/components";

<Badge text="Linux" class="linux" />
<Badge text="Networking" class="networking" />

## Installation

```bash
sudo apt update
sudo apt install openvpn
```

---

## Certificate Generation

### Server CSR

```bash
openssl req -newkey rsa:4096 -sha256 -nodes \
  -keyout "server.key" \
  -out "server.csr" \
  -subj "/CN=OpenVPN Server" \
  -addext "extendedKeyUsage = serverAuth" \
  -addext "keyUsage = digitalSignature, keyEncipherment"
```

### Sign on CA

```bash
openssl ca -in server.csr -out server.crt -days 365
```

### DH Parameters

```bash
openssl dhparam -out dh.pem 2048
```

---

## Server Configuration

Location: `/etc/openvpn/server/server.conf`

```ini
# Network
port 1194
proto udp
dev tun

# Certificates
ca ca.crt
cert server.crt
key server.key
dh dh.pem

# VPN Subnet
server 10.8.0.0 255.255.255.0

# Push routes to clients
push "route 192.168.1.0 255.255.255.0"

# Keep connection alive
keepalive 10 120

# Security
cipher AES-256-GCM
auth SHA256
```

---

## Client Configuration

Location: `/etc/openvpn/client/client.conf`

```ini
client
dev tun
proto udp

# Server address
remote vpn.devhub.local 1194

# Certificates
ca ca.crt
cert client.crt
key client.key

# Security
cipher AES-256-GCM
auth SHA256

# Retry connection
resolv-retry infinite
nobind
persist-key
persist-tun
```

---

## Start/Stop Commands

```bash
# Start server
sudo openvpn /etc/openvpn/server/server.conf

# Start client
sudo openvpn /etc/openvpn/client/client.conf

# As systemd service
sudo systemctl start openvpn-server@server
sudo systemctl start openvpn-client@client

# Enable on boot
sudo systemctl enable openvpn-server@server
```

---

## Gateway Configuration

### Enable IP Forwarding

```bash
# Temporary
sudo sysctl -w net.ipv4.ip_forward=1

# Permanent (add to /etc/sysctl.conf)
net.ipv4.ip_forward=1

# Apply changes
sudo sysctl -p
```

### iptables Rules

```bash
# Allow VPN to LAN
sudo iptables -A FORWARD -i tun0 -s 10.8.0.0/24 -d 192.168.1.0/24 -j ACCEPT

# NAT masquerade
sudo iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE

# Allow return traffic
sudo iptables -A FORWARD -i eth0 -d 10.8.0.0/24 -j ACCEPT
```

### Save iptables

```bash
sudo apt install iptables-persistent
sudo netfilter-persistent save
```

---

## Troubleshooting

```bash
# Check tunnel interface
ip addr show tun0

# View logs
sudo journalctl -u openvpn-server@server -f

# Test connectivity
ping 10.8.0.1

# Check iptables
sudo iptables -L -v
sudo iptables -t nat -L -v
```

---

## File Locations

| File           | Location                                               |
| -------------- | ------------------------------------------------------ |
| Server config  | `/etc/openvpn/server/server.conf`                      |
| Client config  | `/etc/openvpn/client/client.conf`                      |
| Sample configs | `/usr/share/doc/openvpn/examples/sample-config-files/` |
| Logs           | `/var/log/openvpn.log`                                 |

---

## Sources

- [PureLogicIT Training Repository](https://github.com/PureLogicIT)
- [OpenVPN Documentation](https://openvpn.net/community-resources/)
